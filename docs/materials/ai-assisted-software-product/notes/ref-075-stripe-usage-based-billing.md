# [75] Usage-based Billing（Stripe）：把计量口径写成能对账的产品合同

- 原始来源：https://docs.stripe.com/billing/subscriptions/usage-based
- 对应章节：第 9 章（后端架构）、第 12 章（付费与风控）、第 19 章（迭代与增长：定价）

## 一句话摘要
用量计费（usage-based billing）最难的不是怎么算钱，而是怎么算才算同一口径：计量事件、聚合窗口、幂等、补写/更正、对账与退款规则，都是产品合同的一部分。

## 你应该从这里带走什么（面向产品）
- **计费口径是体验的一部分**：用户会把账单是否可解释当作信任指标；模糊口径会直接变成工单与退费。
- **把异常用量当作产品场景**：爆量、重试、重复上报、失败重放、离线补写，这些都会发生；你需要预先设计规则与用户可理解的解释。

## 工程落地要点（可执行）
- 明确三件事并写进 PRD：
  1) **事件口径**：什么算一次用量，事件字段有哪些。
  2) **聚合口径**：按分钟/小时/天聚合？补写如何处理？什么时候封账？
  3) **对账口径**：如何让用户复核（明细/汇总/导出），内部如何对账（账本/发票/支付渠道）。
- 必做的两条门禁：
  - **幂等与去重**：同一事件重复上报，不能重复扣费。
  - **预算止损**：当用量达到阈值，系统必须有降级/停止/告知的路径。

## 常见误用提醒
- **先做定价再补计量**：最后会变成价格写得很好，但算不清楚；0→1 先把口径做可解释，再谈优化。
