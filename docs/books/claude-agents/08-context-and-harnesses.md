# 第 8 章：上下文工程与长任务

在 agent 的世界里，prompt 只是上下文的一部分。工程团队提出“上下文工程”这个说法，是为了提醒我们：真正决定模型行为的是“这一次推理里到底放了哪些信息”。系统指令、工具说明、历史对话、检索结果都在竞争有限的注意力预算，目标不是堆得越多越好，而是把最关键的信号留在窗口里。[61]

这意味着上下文需要被持续整理，而不是一次性写完。系统指令要清晰、工具要有边界、示例要覆盖核心场景；更重要的是，模型需要能够在运行时自己找信息。文章里强调“就地检索”的思路：让模型用文件系统、搜索和工具按需取回材料，而不是把所有材料预先灌进提示词里。[61]

当任务跨度变长时，单一上下文无法承载全部工作。工程文章给出三种常见做法：对对话做压缩，把重要决策保留下来；让模型写结构化笔记，把长期任务的里程碑留在外部文件里；使用子代理并行探索，把复杂的检索分散到多个独立上下文里。[61]

长任务的工程化还需要一个“工作台”。Claude Agent SDK 的长任务文章提出一种双角色结构：初始化代理先搭好环境（脚本、进度记录、功能清单），后续的执行代理只做增量推进，并把结果写入进度文件和 git 记录里。这样的设计让每次新会话都有明确的起点，不需要重新猜测当前状态，也不会因为中途断线而丢失方向。[62]
